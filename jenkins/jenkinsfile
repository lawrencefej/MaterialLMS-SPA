def version

pipeline {
    agent any
    stages {
        stage('initialize_variables') {
      environment {
        commit = "${ env.GIT_COMMIT }"
        tag = sh(script: 'git tag --points-at=HEAD', returnStdout: true)?.trim()
        // tag2 = sh(script: "git describe --tags ${commit}", returnStdout: true)?.trim()
      }
          steps {
            script {
              echo "commit = ${commit}"
              echo "tag = ${tag}"
              // echo "tag2 = ${tag2}"
              if (tag) {
            version = tag
                } else {
            version = commit
              }
            }
          }
        }
        stage('Clone the repo') {
      steps {
        // echo 'clone the repo'
        // sh 'rm -fr MaterialLMS-SPA'
        // sh 'git clone https://github.com/lawrencefej/MaterialLMS-SPA.git'
        // sh 'cd MaterialLMS-SPA'
        sh 'ls -alh'
        // testfunc()
        echo "commit = ${env.GIT_COMMIT}"
        echo "version = ${version}"
        echo "Running ${env.BUILD_ID} on ${env.JENKINS_URL}"
        echo "commit take 7 = ${env.GIT_COMMIT.take(7)}"
      }
        }
    }
}

// def getRepoURL() {
//   sh "git config --get remote.origin.url > .git/remote-url"
//   return readFile(".git/remote-url").trim()
// }

// def testfunc() {
//     repoUrl = getRepoURL()
// }
